namespace = misc

character_event = {
	id = misc.1
	desc = "Replace Sister-Militant"
	picture = GFX_evt_mass_crusade
	is_triggered_only = yes
	religion = ursuline

	trigger = {
		has_landed_title = d_st_ursulas_chosen
	}
	
	option = {
		# Make sure they're a good age
		random_list = {
			10 = { create_random_soldier = {
				random_traits = yes
				religion = ursuline
				culture = quebecois
				female = yes
				age = 30
			} }
			10 = { create_random_soldier = {
				random_traits = yes
				religion = ursuline
				culture = quebecois
				female = yes
				age = 35
			} }
			10 = { create_random_soldier = {
				random_traits = yes
				religion = ursuline
				culture = quebecois
				female = yes
				age = 40
			} }
			20 = { create_random_soldier = {
				random_traits = yes
				religion = ursuline
				culture = quebecois
				female = yes
				age = 45
			} }
			20 = { create_random_soldier = {
				random_traits = yes
				religion = ursuline
				culture = quebecois
				female = yes
				age = 50
			} }
			20 = { create_random_soldier = {
				random_traits = yes
				religion = ursuline
				culture = quebecois
				female = yes
				age = 55
			} }
			10 = { create_random_soldier = {
				random_traits = yes
				religion = ursuline
				culture = quebecois
				female = yes
				age = 60
			} }
		}
		new_character = { ROOT = { any_demesne_title = { gain_title = PREVPREV } } }
	}
}

character_event = {
	id = misc.2
	desc = "Replace Nanacy Harts leader"
	picture = GFX_evt_mass_crusade
	is_triggered_only = yes
	religion = evangelical

	trigger = {
		has_landed_title = d_nancy_harts
	}
	
	option = {
		# Make sure they're a good age
		random_list = {
			10 = { create_random_soldier = {
				random_traits = yes
				female = yes
				age = 30
			} }
			10 = { create_random_soldier = {
				random_traits = yes
				female = yes
				age = 35
			} }
			10 = { create_random_soldier = {
				random_traits = yes
				female = yes
				age = 40
			} }
			20 = { create_random_soldier = {
				random_traits = yes
				female = yes
				age = 45
			} }
			20 = { create_random_soldier = {
				random_traits = yes
				female = yes
				age = 50
			} }
			20 = { create_random_soldier = {
				random_traits = yes
				female = yes
				age = 55
			} }
			10 = { create_random_soldier = {
				random_traits = yes
				female = yes
				age = 60
			} }
		}
		new_character = { ROOT = { any_demesne_title = { gain_title = PREVPREV } } }
	}
}

# Change race for newly-generated chars
#gone, might return idk

# Determine physique for newly-generated chars
character_event = {
	id = misc.4
	desc = "Set physique"
	is_triggered_only = yes
	hide_window = yes
	min_age = 16
	
	trigger = {
		NOT = { has_character_flag = physique }
	}
	
	immediate = {
		set_character_flag = physique
	}
	
	#Neutral option
	option = {
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0.2
				OR = {
					trait = gluttonous
					trait = slothful
					trait = hedonist
					trait = drunkard
					trait = uncouth
				}
			}
			modifier = {
				factor = 0.2
				OR = {
					trait = temperate
					trait = slothful
					trait = groomed
				}
			}
		}
		#nothing happens
	}
	
	#Add weight
	option = {
		ai_chance = { #Block 1: prevents characters with certain traits from even picking the option to begin with
			factor = 1
			modifier = {
				factor = 0
				trait = temperate
			}
			modifier = {
				factor = 0
				trait = weak
			}
			modifier = {
				factor = 0
				trait = feeble
			}
			modifier = {
				factor = 0
				trait = groomed
			}
			modifier = {
				factor = 0.2
				trait = diligent
			}
			modifier = {
				factor = 0.2
				trait = paranoid
			}
			modifier = {
				factor = 0.2
				trait = duelist
			}
			modifier = {
				factor = 0.2
				trait = berserker
			}
			modifier = {
				factor = 0.2
				trait = hunter
			}
			modifier = {
				factor = 0.2
				trait = falconer
			}
			modifier = {
				factor = 0.3
				trait = strong
			}
			modifier = {
				factor = 0.3
				trait = robust
			}
			modifier = {
				factor = 0.4
				trait = sturdy
			}
			modifier = {
				factor = 0.4
				trait = monk
			}
			modifier = {
				factor = 0.4
				trait = nun
			}
			modifier = { #religious factor
				factor = 0.5
				OR = {
					religion_group = pacific
					religion_group = indian_group
					religion = neognostic
				}
			}
		}
		if = { #Block 2: Determines % chance for effect to be applied depending on other applicable traits
			limit = { #has both gluttonous and another relevant
				trait = gluttonous
				OR = {
					trait = greedy
					trait = content
					trait = hedonist
					trait = uncouth
					trait = slothful
					trait = drunkard
				}
			}
			random_list = {
				45 = {
					gain_weight_small_effect = yes
					weight_trait_check_effect = yes
				}
				35 = {
					gain_weight_medium_effect = yes
					weight_trait_check_effect = yes
				}
				20 = {
					gain_weight_large_effect = yes
					weight_trait_check_effect = yes
				}
			}
		}
		else_if = {
			limit = {
				OR = { #has just one relevant
					trait = gluttonous
					trait = greedy
					trait = content
					trait = hedonist
					trait = uncouth
					trait = slothful
					trait = drunkard
				}
			}
			random_list = {
				60 = {
					gain_weight_small_effect = yes
					weight_trait_check_effect = yes
				}
				30 = {
					gain_weight_medium_effect = yes
					weight_trait_check_effect = yes
				}
				10 = {
					gain_weight_large_effect = yes
					weight_trait_check_effect = yes
				}
			}
		}
		else = { #All other cases
			random_list = {
				80 = {
					gain_weight_small_effect = yes
					weight_trait_check_effect = yes
				}
				15 = {
					gain_weight_medium_effect = yes
					weight_trait_check_effect = yes
				}
				5 = {
					gain_weight_large_effect = yes
					weight_trait_check_effect = yes
				}
			}
		}
	}
	
	#Remove weight
	option = {
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0
				trait = gluttonous
			}
			modifier = {
				factor = 0
				trait = drunkard
			}
			modifier = {
				factor = 0
				trait = hedonist
			}
			modifier = {
				factor = 0
				trait = sturdy
			}
			modifier = {
				factor = 0
				trait = uncouth
			}
			modifier = {
				factor = 0.1
				trait = strong
			}
			modifier = {
				factor = 0.1
				trait = robust
			}
			modifier = {
				factor = 0.2
				trait = slothful
			}
			modifier = {
				factor = 0.2
				trait = content
			}
			modifier = {
				factor = 0.2
				trait = duelist
			}
			modifier = {
				factor = 0.2
				trait = berserker
			}
			modifier = {
				factor = 0.2
				trait = hunter
			}
			modifier = {
				factor = 0.4
				trait = monk
			}
			modifier = {
				factor = 0.4
				trait = nun
			}
			modifier = { #religious factor
				factor = 0.5
				OR = {
					religion_group = nautical
					religion = consumerist
				}
			}
		}
		if = {
			limit = { #has both temperate and another relevant
				trait = temperate
				OR = {
					trait = diligent
					trait = paranoid
					trait = envious #more likely to care about body image
					trait = groomed
					trait = patient
					trait = chaste
				}
			}
			random_list = {
				45 = {
					lose_weight_small_effect = yes
					weight_trait_check_effect = yes
				}
				35 = {
					lose_weight_medium_effect = yes
					weight_trait_check_effect = yes
				}
				20 = {
					lose_weight_large_effect = yes
					weight_trait_check_effect = yes
				}
			}
		}
		else_if = {
			limit = {
				OR = { #has just one relevant
					trait = temperate
					trait = diligent
					trait = paranoid
					trait = envious
					trait = groomed
					trait = patient
					trait = chaste
				}
			}
			random_list = {
				60 = {
					lose_weight_small_effect = yes
					weight_trait_check_effect = yes
				}
				30 = {
					lose_weight_medium_effect = yes
					weight_trait_check_effect = yes
				}
				10 = {
					lose_weight_large_effect = yes
					weight_trait_check_effect = yes
				}
			}
		}
		else = { #All other cases
			random_list = {
				80 = {
					lose_weight_small_effect = yes
					weight_trait_check_effect = yes
				}
				15 = {
					lose_weight_medium_effect = yes
					weight_trait_check_effect = yes
				}
				5 = {
					lose_weight_large_effect = yes
					weight_trait_check_effect = yes
				}
			}
		}
	}	
}

# Do this for all random courtiers at the start of the game
# Game initialization event, called from on_startup
character_event = {
	id = misc.5
	desc = "Game initialization"
	is_triggered_only = yes
	hide_window = yes
	
	trigger = {
		NOT = { has_global_flag = scenario_initialized }
		controls_religion = yes
		religion = catholic # only for the Pope
	}
	
	option = {
		set_global_flag = scenario_initialized

		# Diversity
		any_independent_ruler = {
			any_realm_character = {
				if = {
					limit = {
						# This should figure out which characters have been randomly generated and haven't been around for long
						#is_ruler = no # uncomment this once we have the map filled out
						ai = yes
						NOT = { father_even_if_dead = { always = yes } }
						NOT = { mother_even_if_dead = { always = yes } }
						NOT = { spouse_even_if_dead = { always = yes } }
						NOT = { any_child = { always = yes } }
						NOT = { has_character_flag = diversity }
					}
					character_event = { id = misc.3 }
				}
				if = {
					limit = {
						# This should figure out which characters have been randomly generated and haven't been around for long
						#is_ruler = no # uncomment this once we have the map filled out
						ai = yes
						NOT = { father_even_if_dead = { always = yes } }
						NOT = { mother_even_if_dead = { always = yes } }
						NOT = { spouse_even_if_dead = { always = yes } }
						NOT = { any_child = { always = yes } }
						NOT = { has_character_flag = physique } #for characters that are meant to be neither
					}
					character_event = { id = misc.4 }
				}
			}
		}
		
		# Ursuline priests and holy orders
		any_independent_ruler = {
			any_realm_character = {
				limit = {
					NOT = { has_alternate_start_parameter = { key = religion_names value = random } }
					OR = {
						is_female = no
						NOT = { has_law = enatic_succession }
					}
					religion = ursuline
					OR = {
						is_theocracy = yes
						holy_order = yes
					}
					is_ruler = yes
				}
				character_event = { id = misc.6 }
			}
		}
		
		# Gaian priests
		any_independent_ruler = {
			any_realm_character = {
				limit = {
					NOT = { has_alternate_start_parameter = { key = religion_names value = random } }
					OR = {
						is_female = no
						NOT = { has_law = enatic_succession }
					}
					religion = gaian
					OR = {
						is_theocracy = yes
					}
					is_ruler = yes
				}
				character_event = { id = misc.16 }
			}
		}
		
		# Libertarian religious head
		any_independent_ruler = {
			any_realm_character = {
				limit = {
					NOT = { has_alternate_start_parameter = { key = religion_names value = random } }
					has_landed_title = d_libertarian
					is_female = no
				}
				character_event = { id = misc.8 }
			}
		}
		
		# Other priests
		any_independent_ruler = {
			any_realm_character = {
				limit = {
					NOT = { has_alternate_start_parameter = { key = religion_names value = random } }
					NOT = { has_law = enatic_succession }
					OR = {
						religion = high_church
						religion = strangite
						religion = reform
						religion = neomayan
					}
					is_theocracy = yes
					is_ruler = yes
				}
				character_event = { id = misc.9 }
			}
		}
		
		any_independent_ruler = {
			any_realm_character = {
				limit = {
					has_dlc = "Holy Fury"
					OR = {
						AND = {
							NOT = { has_alternate_start_parameter = { key = religion_names value = random } }
							OR = {
								religion = gaian
								religion = neomayan
							}
						}
						has_religion_feature = religion_astrology
						has_religion_feature = religion_feature_occultist
					}
				}
				character_event = { id = HFATE.100 }
			}
		}
		
		any_independent_ruler = {
			any_realm_character = {
				limit = {
					has_dlc = "Sons of Abraham"
					NOT = { has_alternate_start_parameter = { key = religion_names value = random } }
					religion = rastafarian
					is_adult = yes
				}
				character_event = { id = SOAATE.100 }
			}
		}
	}
}

character_event = {
	id = misc.6
	desc = "Make Ursuline priests and holy orders female"
	is_triggered_only = yes
	hide_window = yes
	religion = ursuline
	
	trigger = {
		NOT = { has_alternate_start_parameter = { key = religion_names value = random } }
		OR = {
			is_theocracy = yes
			holy_order = yes
		}
		OR = {
			is_female = no
			NOT = { has_law = enatic_succession }
		}
		is_ruler = yes
	}
	
	option = {
		primary_title = { add_law = enatic_succession }
		trigger = { is_theocracy = yes }
		if = {
			limit = { is_female = no }
			create_random_priest = {
				female = yes
				religion = ursuline
				random_traits = yes
				dynasty = culture
			}
			new_character = {
				#character_event = { id = misc.3 } # Diversity
				remove_trait = lustful
				remove_trait = hedonist
				remove_trait = drunkard
				remove_trait = imbecile
				remove_trait = distractible
				remove_trait = slow
				character_event = { id = misc.4 } # Physique
				ROOT = {
					abdicate_to = PREV
				}
			}
		}
		set_government_type = theocracy_government
	}
	
	option = {
		primary_title = { add_law = enatic_succession }
		trigger = { holy_order = yes }
		if = {
			limit = { is_female = no }
			create_random_soldier = {
				female = yes
				religion = ursuline
				random_traits = yes
			}
			new_character = {
				#character_event = { id = misc.3 } # Diversity
				remove_trait = craven
				remove_trait = weak
				remove_trait = clubfooted
				character_event = { id = misc.4 } # Physique
				ROOT = {
					abdicate_to = PREV
				}
			}
		}
		set_government_type = order_government
	}
}

character_event = {
	id = misc.7
	desc = "Ursuline death trigger"
	is_triggered_only = yes
	hide_window = yes
	religion = ursuline
	
	trigger = {
		NOT = { has_alternate_start_parameter = { key = religion_names value = random } }
		is_theocracy = yes
		is_ruler = yes
		controls_religion = no # Abbess-General has separate events
		NOT = { current_heir = { is_female = yes } } # Preserve investiture if valid
	}
	
	option = {
		create_random_priest = {
			random_traits = yes
			female = yes
			religion = ursuline
		}
		new_character = {
			ROOT = {
				any_demesne_title = { gain_title = PREVPREV }
			}
			primary_title = { add_law = enatic_succession }
		}
	}
}

character_event = {
	id = misc.8
	desc = "Replace First Lady"
	is_triggered_only = yes
	hide_window = yes
	religion = libertarian
	
	trigger = {
		NOT = { has_alternate_start_parameter = { key = religion_names value = random } }
		has_landed_title = d_libertarian
		NOT = { current_heir = { is_female = yes } }
	}
	
	option = {
		create_random_priest = {
			random_traits = yes
			female = yes
			religion = libertarian
		}
		new_character = {
			ROOT = {
				any_demesne_title = { gain_title = PREVPREV }
			}
			primary_title = { add_law = enatic_succession }
		}
	}
}

character_event = {
	id = misc.9
	desc = "High Church and Strangite Investiture"
	is_triggered_only = yes
	hide_window = yes
	
	trigger = {
		NOT = { has_alternate_start_parameter = { key = religion_names value = random } }
		is_theocracy = yes
		OR = {
			religion = high_church
			religion = strangite
			religion = reform
			religion = neomayan
		}
		NOT = { has_law = true_cognatic_succession }
	}
	
	option = {
		primary_title = { add_law = true_cognatic_succession }
	}
}

character_event = {
	id = misc.11
	desc = "Replace Leader of the Labrys Band"
	picture = GFX_evt_mass_crusade
	is_triggered_only = yes
	religion = gaian

	trigger = {
		has_landed_title = d_labrys_band
	}
	
	option = {
		# Make sure they're a good age
		random_list = {
			10 = { create_random_soldier = {
				random_traits = yes
				female = yes
				trait=homosexual
				age = 30
			} }
			10 = { create_random_soldier = {
				random_traits = yes
				female = yes
				trait=homosexual
				age = 35
			} }
			10 = { create_random_soldier = {
				random_traits = yes
				female = yes
				trait=homosexual
				age = 40
			} }
			20 = { create_random_soldier = {
				random_traits = yes
				female = yes
				trait=homosexual
				age = 45
			} }
			20 = { create_random_soldier = {
				random_traits = yes
				female = yes
				trait=homosexual
				age = 50
			} }
			20 = { create_random_soldier = {
				random_traits = yes
				female = yes
				trait=homosexual
				age = 55
			} }
			10 = { create_random_soldier = {
				random_traits = yes
				female = yes
				trait=homosexual
				age = 60
			} }
		}
		new_character = { ROOT = { any_demesne_title = { gain_title = PREVPREV } } }
	}
}

character_event = {
	id = misc.12
	desc = "Reformation trigger"
	is_triggered_only = yes
	hide_window = yes
	
	trigger = {
		has_religion_feature = religion_matriarchal
		is_theocracy = yes
		is_ruler = yes
		controls_religion = no # prevents weirdness
	}
	
	option = {
		create_random_priest = {
			random_traits = yes
			female = yes
			religion = ursuline
		}
		new_character = {
			ROOT = {
				any_demesne_title = { gain_title = PREVPREV }
			}
			primary_title = { add_law = enatic_succession }
		}
	}
}

#On_death: sunglasses
character_event = {
	id = misc.13
	hide_window = yes

	is_triggered_only = yes
	
	trigger = { 
		any_artifact = { artifact_type = old_world_shades } 
	}
	
	immediate = {
		if = { 
			limit = { 
				any_artifact = { artifact_type = old_world_shades }
			}
			add_trait = dead_shades
		}
	}
}

character_event = {
	id = misc.14
	desc = EVTDESC_cast_jailer
	picture = GFX_evt_torture
	
	is_triggered_only = yes
	
	option = {
		name = OK
	}
}

character_event = {
	id = misc.15
	desc = EVTDESC_cast_prisoner
	picture = GFX_evt_torture
	
	hide_from = yes
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTALoR.833
	}
}

character_event = {
	id = misc.16
	desc = "Make Gaian priests female"
	is_triggered_only = yes
	hide_window = yes
	religion = gaian
	
	trigger = {
		NOT = { has_alternate_start_parameter = { key = religion_names value = random } }
		is_theocracy = yes
		OR = {
			is_female = no
			NOT = { has_law = enatic_succession }
		}
		is_ruler = yes
	}
	
	immediate = {
		primary_title = { add_law = enatic_succession }
		if = {
			limit = { is_female = no }
			create_random_priest = {
				female = yes
				religion = gaian
				random_traits = yes
			}
			new_character = {
				#character_event = { id = misc.3 } # Diversity
				remove_trait = lustful
				remove_trait = hedonist
				remove_trait = drunkard
				remove_trait = imbecile
				remove_trait = distractible
				remove_trait = slow
				character_event = { id = misc.4 } # Physique
				ROOT = {
					abdicate_to = PREV
				}
			}
		}
		set_government_type = theocracy_government
	}
}

character_event = {
	id = misc.17
	desc = "Gaian death trigger"
	is_triggered_only = yes
	hide_window = yes
	religion = gaian
	
	trigger = {
		NOT = { has_alternate_start_parameter = { key = religion_names value = random } }
		is_theocracy = yes
		is_ruler = yes
		NOT = { current_heir = { is_female = yes } } # Preserve investiture if valid
	}
	
	immediate = {
		create_random_priest = {
			random_traits = yes
			female = yes
			religion = gaian
		}
		new_character = {
			ROOT = {
				any_demesne_title = { gain_title = PREVPREV }
			}
			primary_title = { add_law = enatic_succession }
		}
	}
}